name: Run Job_Creation notebook

on:
  push:
    branches: ["main"]

jobs:
  run-notebook:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Setup Databricks CLI
        uses: databricks/setup-cli@main

      - name: Run Job_Creation notebook
        run: |
          export DATABRICKS_HOST="https://adb-3960540793376249.9.azuredatabricks.net"
          export DATABRICKS_TOKEN="dapi828505898b09f05c31fbae36860911dc-3"
      
          # Delete old notebook (ignore error if not exist)
          databricks workspace delete \
            /Workspace/Users/sachin.kumar@snp.com/GitDeployment/Job_Creation \
            --recursive --yes || true
      
          # Import new notebook from DBC archive
          databricks workspace import \
            /Workspace/Users/sachin.kumar@snp.com/GitDeployment/Job_Creation \
            --file Job_Creation.dbc \
            --format DBC
      
          # Trigger notebook execution
          databricks jobs submit --json '{
            "run_name": "Job_Creation",
            "tasks": [
              {
                "task_key": "job_creation",
                "existing_cluster_id": "1124-094650-0nervcma",
                "notebook_task": {
                  "notebook_path": "/Workspace/Users/sachin.kumar@snp.com/GitDeployment/Job_Creation",
                  "source": "WORKSPACE"
                }
              }
            ]
          }'
        
        
              
